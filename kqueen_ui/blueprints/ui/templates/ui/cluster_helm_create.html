{% from "ui/partial/form.html" import render_form %}

{{ render_form(form, action=action) }}

<script>
$('.modal input[type=submit]').click(function(ev){
  var form = $('.modal input[type=submit]').closest('form'),
      btn = $('.modal input[type=submit]');
  ev.preventDefault();
  $.post(form.attr('action'), form.serialize(), function(data){
    if( typeof data === 'object' ){
      if( window.location.href.endsWith(data.redirect) ){
        window.location.reload(1);
      }else{
        window.location.replace(data.redirect);
      }
    }else{
      btn.off();
      $('#asyncModal .modal-body').html(data);
    }
  ;})
;});
</script>
